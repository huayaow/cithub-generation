# cithub-generation

**cithub-generation** is a configurable web service that can invoke different standalone covering array generation tools to generate covering arrays.



## Deployment & Usage

The service can be deployed using the pre-build Docker image. Just pull the image from DockerHub, and then run the container (with specific hardware constraints):

```bash
docker pull waynedd/cithub-generation:2.0
```

```bash
docker run -d -p [port]:6000 --cpus=4 --memory=16G --name [service_name] waynedd/cithub-generation:2.0
```

Once the service is ready, the specific generation algorithm can be visited via an HTTP Post method:

```python
import requests

data = {
  'algorithm': 'acts', 
  'name': 'aircraft', 
  'strength': 2, 
  'model_text': open('example/models/aircraft-acts.model')
}

r = requests.post('http://127.0.0.1:[port]/generation', data=data)
print(r.json())
```

Currently, nine covering array generation tools are supported, including `acts`, `pict`, `casa`, `fastca`, `jenny`, `medici`, `tcases`, `coffee4j`, and `jcunit`. See `example/example.py` and this [doc](Usage.md) for more details of using the above tools in this service.

**Note**

* The service will only invoke the core generation algorithm of each tool. Other available functionalities of these tools (e.g., coverage measurement, fault diagnosis, etc.) are not supported.
* The main focus of this service is on the quality of abstract covering arrays generated by different tools (that is, array size and time cost). So some aspects of modelling languages of original tools might not be completely supported.



## Add New Tools

In order to add a new covering array generation tool into the service, two modifications are required:

1. prepare a configuration file
2. write a function that extracts array sizes



#### Configuration File

`cithub-generation` uses a configuration file (in JSON format) to describe the necessary information of running each spesific tool. For example, the following code block gives the configuration file of ACTS (i.e., `configuration/acts.json`):

```json
{
  "name": "ACTS",
  "version": "3.0",
  "author": "NIST",
  "link": "https://csrc.nist.gov/Projects/automated-combinatorial-testing-for-software/downloadable-tools",
  "input": [
    {
      "name": "model",
      "type": "file"
    },
    {
      "name": "strength",
      "type": "number"
    }
  ],
  "output": {
    "name": "output",
    "type": "file"
  },
  "bin": "acts_3.0.jar",
  "run": "java -Ddoi=[strength] -Doutput=numeric -jar acts_3.0.jar [model] [output]"
}
```

Specifially,

* All input parameters of running the tool should be given in the `input` section. Typical input parameters include `model`, `constraint`, and `strength`. Note that some tools might take a `SEED`  parameter, and this parameter does not need to be explicitly described (a random seed value will always be used in each execution).
* Each tool should provide an `output` parameter, of either `file` or `stdout` type. For the former case, the tool will write the covering array generated into a file; while for the latter case, the generation result can only be obtained from the stdout of the execution.

*  `bin` gives the executable binary file of the tool. 
*  `run` gives the particular command to execute the tool, where each input parameter should be placed into a square brackets `[]`, and the optional part can be placed into a brace `{}`. Each input parameter here should be explicitly described in `input` and `output` sections (except `[SEED]`).



#### Extraction Function

Once the execution of the tool finishes,  `cithub-generation` will call the `array_size()` function of the `Extraction` class to extract the exact size of the covering array generated (see `extraction.py`). The input of this process is the `stdout` file by default, because the tool might run out of time, where no array file is produced.

For example, the following gives the extraction function of ACTS.

```python
@staticmethod
def acts(console):
  for line in console[::-1]:
    if line.startswith('Number of Tests'):
      num = line.strip().split()[-1]
      if num.isdigit():
        return int(num)
      return None
```



#### Build

After the update, build and publish the new image:

```bash
docker build -t username/cithub-generation:tag .
```

```bash
docker push username/cithub-generation:tag
```



**Note**: the current version of  `cithub-generation` is especially designed for packaging an existing command-line tool. If you wish to deploy an algorithm that is under development, it is recommended to design and implement it as a native web service.

